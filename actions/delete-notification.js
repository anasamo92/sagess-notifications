import fetch from 'isomorphic-fetch';
import { getConfig } from '../config';
import { clearError, setError } from './error';

//Import other actions
import { readNotification, readNotificationGroup } from './';

//Notification actions
export var DELETE_NOTIFICATION = 'DELETE_NOTIFICATION';
export var SUCCESS_DELETE_NOTIFICATION = 'SUCCESS_DELETE_NOTIFICATION';
export var FAIL_DELETE_NOTIFICATION = 'FAIL_DELETE_NOTIFICATION';

//Notification group actions

export var DELETE_NOTIFICATION_GROUP = 'DELETE_NOTIFICATION_GROUP';
export var SUCCESS_DELETE_NOTIFICATION_GROUP = 'SUCCESS_DELETE_NOTIFICATION_GROUP';
export var FAIL_DELETE_NOTIFICATION_GROUP = 'FAIL_DELETE_NOTIFICATION_GROUP';

function deleteNotificationSuccess(jsonDeleted) {
    return {
        type: SUCCESS_DELETE_NOTIFICATION,
        payload: jsonDeleted
    };
}

//
function deleteNotificationGroupSuccess(notificationIds) {
    return {
        type: SUCCESS_DELETE_NOTIFICATION_GROUP,
        payload: notificationIds
    };
}

//
export function deleteNotification(notificationId) {
    return function callDeleteNotification(dispatch) {
        //read the conf after extension.
        var config = getConfig();
        //Create the URL
        var URL = config.rootURL + '/' + config.notificationURL;
        //Maybe see https://github.com/rackt/redux/issues/911#issuecomment-149361073 for a saner implementation instead of chaining two dispatch.
        dispatch(clearError());
        dispatch(readNotification(notificationId));

        var credentialOptions = config.useCredentials ? { credentials: 'include' } : {};
        var contentType = config.noContentType ? {} : config.contentType ? { headers: { contentType: contentType } } : { headers: { 'Content-Type': 'application/json' } };

        return fetch(URL + '/' + notificationId, Object.assign({ method: 'delete' }, credentialOptions, contentType)).then(function (response) {
            return response && response.status !== 204 ? response.json() : undefined;
        }).then(function (json) {
            return dispatch(deleteNotificationSuccess(json));
        }).catch(function (err) {
            return dispatch(setError({ content: err.message, type: 'network' }));
        });
    };
}

//
export function deleteGroupNotification(notificationIds) {
    return function callDeleteNotificationGroup(dispatch) {
        //read the conf after extension.
        var config = getConfig();
        //Create the URL
        var URL = config.rootURL + '/' + config.notificationURL;
        //Maybe see https://github.com/rackt/redux/issues/911#issuecomment-149361073 for a saner implementation instead of chaining two dispatch.
        dispatch(clearError());
        dispatch(readNotificationGroup(notificationIds));

        var credentialOptions = config.useCredentials ? { credentials: 'include' } : {};
        var contentType = config.noContentType ? {} : config.contentType ? { headers: { contentType: contentType } } : { headers: { 'Content-Type': 'application/json' } };

        return fetch('' + URL, Object.assign({ method: 'delete', body: JSON.stringify(notificationIds) }, credentialOptions, contentType)).then(function (response) {
            return response && response.status !== 204 ? response.json() : undefined;
        }).then(function (json) {
            return dispatch(deleteNotificationGroupSuccess(json));
        }).catch(function (err) {
            return dispatch(setError({ content: err.message, type: 'network' }));
        });
    };
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInNob3J0ZW4uanMiXSwibmFtZXMiOlsiZmV0Y2giLCJnZXRDb25maWciLCJjbGVhckVycm9yIiwic2V0RXJyb3IiLCJyZWFkTm90aWZpY2F0aW9uIiwicmVhZE5vdGlmaWNhdGlvbkdyb3VwIiwiREVMRVRFX05PVElGSUNBVElPTiIsIlNVQ0NFU1NfREVMRVRFX05PVElGSUNBVElPTiIsIkZBSUxfREVMRVRFX05PVElGSUNBVElPTiIsIkRFTEVURV9OT1RJRklDQVRJT05fR1JPVVAiLCJTVUNDRVNTX0RFTEVURV9OT1RJRklDQVRJT05fR1JPVVAiLCJGQUlMX0RFTEVURV9OT1RJRklDQVRJT05fR1JPVVAiLCJkZWxldGVOb3RpZmljYXRpb25TdWNjZXNzIiwianNvbkRlbGV0ZWQiLCJ0eXBlIiwicGF5bG9hZCIsImRlbGV0ZU5vdGlmaWNhdGlvbkdyb3VwU3VjY2VzcyIsIm5vdGlmaWNhdGlvbklkcyIsImRlbGV0ZU5vdGlmaWNhdGlvbiIsIm5vdGlmaWNhdGlvbklkIiwiY2FsbERlbGV0ZU5vdGlmaWNhdGlvbiIsImRpc3BhdGNoIiwiY29uZmlnIiwiVVJMIiwicm9vdFVSTCIsIm5vdGlmaWNhdGlvblVSTCIsImNyZWRlbnRpYWxPcHRpb25zIiwidXNlQ3JlZGVudGlhbHMiLCJjcmVkZW50aWFscyIsImNvbnRlbnRUeXBlIiwibm9Db250ZW50VHlwZSIsImhlYWRlcnMiLCJtZXRob2QiLCJ0aGVuIiwicmVzcG9uc2UiLCJzdGF0dXMiLCJqc29uIiwidW5kZWZpbmVkIiwiY2F0Y2giLCJjb250ZW50IiwiZXJyIiwibWVzc2FnZSIsImRlbGV0ZUdyb3VwTm90aWZpY2F0aW9uIiwiY2FsbERlbGV0ZU5vdGlmaWNhdGlvbkdyb3VwIiwiYm9keSIsIkpTT04iLCJzdHJpbmdpZnkiXSwibWFwcGluZ3MiOiJBQUFBLE9BQU9BLEtBQVAsTUFBa0Isa0JBQWxCO0FBQ0EsU0FBUUMsU0FBUixRQUF3QixXQUF4QjtBQUNBLFNBQVFDLFVBQVIsRUFBb0JDLFFBQXBCLFFBQW1DLFNBQW5DOztBQUVBO0FBQ0EsU0FBUUMsZ0JBQVIsRUFBMEJDLHFCQUExQixRQUFzRCxJQUF0RDs7QUFFQTtBQUNBLE9BQU8sSUFBTUMsc0JBQXNCLHFCQUE1QjtBQUNQLE9BQU8sSUFBTUMsOEJBQThCLDZCQUFwQztBQUNQLE9BQU8sSUFBTUMsMkJBQTJCLDBCQUFqQzs7QUFFUDs7QUFFQSxPQUFPLElBQU1DLDRCQUE0QiwyQkFBbEM7QUFDUCxPQUFPLElBQU1DLG9DQUFvQyxtQ0FBMUM7QUFDUCxPQUFPLElBQU1DLGlDQUFpQyxnQ0FBdkM7O0FBRVAsU0FBU0MseUJBQVQsQ0FBbUNDLFdBQW5DLEVBQWdEO0FBQzVDLFdBQU87QUFDSEMsY0FBTVAsMkJBREg7QUFFSFEsaUJBQVNGO0FBRk4sS0FBUDtBQUlIOztBQUVEO0FBQ0EsU0FBU0csOEJBQVQsQ0FBd0NDLGVBQXhDLEVBQXlEO0FBQ3JELFdBQU87QUFDSEgsY0FBTUosaUNBREg7QUFFSEssaUJBQVNFO0FBRk4sS0FBUDtBQUlIOztBQUVEO0FBQ0EsT0FBTyxTQUFTQyxrQkFBVCxDQUE0QkMsY0FBNUIsRUFBNEM7QUFDL0MsV0FBTyxTQUFTQyxzQkFBVCxDQUFnQ0MsUUFBaEMsRUFBMEM7QUFDN0M7QUFDQSxZQUFNQyxTQUFTckIsV0FBZjtBQUNBO0FBQ0EsWUFBTXNCLE1BQVNELE9BQU9FLE9BQWhCLFNBQTJCRixPQUFPRyxlQUF4QztBQUNBO0FBQ0FKLGlCQUFTbkIsWUFBVDtBQUNBbUIsaUJBQVNqQixpQkFBaUJlLGNBQWpCLENBQVQ7O0FBRUEsWUFBTU8sb0JBQW9CSixPQUFPSyxjQUFQLEdBQXdCLEVBQUVDLGFBQWEsU0FBZixFQUF4QixHQUFvRCxFQUE5RTtBQUNBLFlBQU1DLGNBQWNQLE9BQU9RLGFBQVAsR0FBdUIsRUFBdkIsR0FBNEJSLE9BQU9PLFdBQVAsR0FBcUIsRUFBQ0UsU0FBUyxFQUFDRix3QkFBRCxFQUFWLEVBQXJCLEdBQWdELEVBQUVFLFNBQVMsRUFBQyxnQkFBZ0Isa0JBQWpCLEVBQVgsRUFBaEc7O0FBRUEsZUFBTy9CLE1BQVN1QixHQUFULFNBQWdCSixjQUFoQixrQkFBbUNhLFFBQVEsUUFBM0MsSUFBd0ROLGlCQUF4RCxFQUE4RUcsV0FBOUUsR0FDTkksSUFETSxDQUNEO0FBQUEsbUJBQVlDLFlBQVlBLFNBQVNDLE1BQVQsS0FBb0IsR0FBaEMsR0FBc0NELFNBQVNFLElBQVQsRUFBdEMsR0FBd0RDLFNBQXBFO0FBQUEsU0FEQyxFQUVOSixJQUZNLENBRUQ7QUFBQSxtQkFBUVosU0FBU1QsMEJBQTBCd0IsSUFBMUIsQ0FBVCxDQUFSO0FBQUEsU0FGQyxFQUdORSxLQUhNLENBR0E7QUFBQSxtQkFBT2pCLFNBQVNsQixTQUFTLEVBQUNvQyxTQUFTQyxJQUFJQyxPQUFkLEVBQXVCM0IsTUFBTSxTQUE3QixFQUFULENBQVQsQ0FBUDtBQUFBLFNBSEEsQ0FBUDtBQUlILEtBaEJEO0FBaUJIOztBQUVEO0FBQ0EsT0FBTyxTQUFTNEIsdUJBQVQsQ0FBaUN6QixlQUFqQyxFQUFrRDtBQUNyRCxXQUFPLFNBQVMwQiwyQkFBVCxDQUFxQ3RCLFFBQXJDLEVBQStDO0FBQ2xEO0FBQ0EsWUFBTUMsU0FBU3JCLFdBQWY7QUFDQTtBQUNBLFlBQU1zQixNQUFTRCxPQUFPRSxPQUFoQixTQUEyQkYsT0FBT0csZUFBeEM7QUFDQTtBQUNBSixpQkFBU25CLFlBQVQ7QUFDQW1CLGlCQUFTaEIsc0JBQXNCWSxlQUF0QixDQUFUOztBQUVBLFlBQU1TLG9CQUFvQkosT0FBT0ssY0FBUCxHQUF3QixFQUFFQyxhQUFhLFNBQWYsRUFBeEIsR0FBb0QsRUFBOUU7QUFDQSxZQUFNQyxjQUFjUCxPQUFPUSxhQUFQLEdBQXVCLEVBQXZCLEdBQTRCUixPQUFPTyxXQUFQLEdBQXFCLEVBQUNFLFNBQVMsRUFBQ0Ysd0JBQUQsRUFBVixFQUFyQixHQUFnRCxFQUFFRSxTQUFTLEVBQUMsZ0JBQWdCLGtCQUFqQixFQUFYLEVBQWhHOztBQUVBLGVBQU8vQixXQUFTdUIsR0FBVCxrQkFBaUJTLFFBQVEsUUFBekIsRUFBbUNZLE1BQU1DLEtBQUtDLFNBQUwsQ0FBZTdCLGVBQWYsQ0FBekMsSUFBNkVTLGlCQUE3RSxFQUFtR0csV0FBbkcsR0FDTkksSUFETSxDQUNEO0FBQUEsbUJBQVlDLFlBQVlBLFNBQVNDLE1BQVQsS0FBb0IsR0FBaEMsR0FBc0NELFNBQVNFLElBQVQsRUFBdEMsR0FBd0RDLFNBQXBFO0FBQUEsU0FEQyxFQUVGSixJQUZFLENBRUc7QUFBQSxtQkFBUVosU0FBU0wsK0JBQStCb0IsSUFBL0IsQ0FBVCxDQUFSO0FBQUEsU0FGSCxFQUdGRSxLQUhFLENBR0k7QUFBQSxtQkFBT2pCLFNBQVNsQixTQUFTLEVBQUNvQyxTQUFTQyxJQUFJQyxPQUFkLEVBQXVCM0IsTUFBTSxTQUE3QixFQUFULENBQVQsQ0FBUDtBQUFBLFNBSEosQ0FBUDtBQUlILEtBaEJEO0FBaUJIIiwiZmlsZSI6InNob3J0ZW4uanMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgZmV0Y2ggZnJvbSAnaXNvbW9ycGhpYy1mZXRjaCc7XHJcbmltcG9ydCB7Z2V0Q29uZmlnfSBmcm9tICcuLi9jb25maWcnO1xyXG5pbXBvcnQge2NsZWFyRXJyb3IsIHNldEVycm9yfSBmcm9tICcuL2Vycm9yJztcclxuXHJcbi8vSW1wb3J0IG90aGVyIGFjdGlvbnNcclxuaW1wb3J0IHtyZWFkTm90aWZpY2F0aW9uLCByZWFkTm90aWZpY2F0aW9uR3JvdXB9IGZyb20gJy4vJztcclxuXHJcbi8vTm90aWZpY2F0aW9uIGFjdGlvbnNcclxuZXhwb3J0IGNvbnN0IERFTEVURV9OT1RJRklDQVRJT04gPSAnREVMRVRFX05PVElGSUNBVElPTic7XHJcbmV4cG9ydCBjb25zdCBTVUNDRVNTX0RFTEVURV9OT1RJRklDQVRJT04gPSAnU1VDQ0VTU19ERUxFVEVfTk9USUZJQ0FUSU9OJztcclxuZXhwb3J0IGNvbnN0IEZBSUxfREVMRVRFX05PVElGSUNBVElPTiA9ICdGQUlMX0RFTEVURV9OT1RJRklDQVRJT04nO1xyXG5cclxuLy9Ob3RpZmljYXRpb24gZ3JvdXAgYWN0aW9uc1xyXG5cclxuZXhwb3J0IGNvbnN0IERFTEVURV9OT1RJRklDQVRJT05fR1JPVVAgPSAnREVMRVRFX05PVElGSUNBVElPTl9HUk9VUCc7XHJcbmV4cG9ydCBjb25zdCBTVUNDRVNTX0RFTEVURV9OT1RJRklDQVRJT05fR1JPVVAgPSAnU1VDQ0VTU19ERUxFVEVfTk9USUZJQ0FUSU9OX0dST1VQJ1xyXG5leHBvcnQgY29uc3QgRkFJTF9ERUxFVEVfTk9USUZJQ0FUSU9OX0dST1VQID0gJ0ZBSUxfREVMRVRFX05PVElGSUNBVElPTl9HUk9VUCc7XHJcblxyXG5mdW5jdGlvbiBkZWxldGVOb3RpZmljYXRpb25TdWNjZXNzKGpzb25EZWxldGVkKSB7XHJcbiAgICByZXR1cm4ge1xyXG4gICAgICAgIHR5cGU6IFNVQ0NFU1NfREVMRVRFX05PVElGSUNBVElPTixcclxuICAgICAgICBwYXlsb2FkOiBqc29uRGVsZXRlZFxyXG4gICAgfTtcclxufVxyXG5cclxuLy9cclxuZnVuY3Rpb24gZGVsZXRlTm90aWZpY2F0aW9uR3JvdXBTdWNjZXNzKG5vdGlmaWNhdGlvbklkcykge1xyXG4gICAgcmV0dXJuIHtcclxuICAgICAgICB0eXBlOiBTVUNDRVNTX0RFTEVURV9OT1RJRklDQVRJT05fR1JPVVAsXHJcbiAgICAgICAgcGF5bG9hZDogbm90aWZpY2F0aW9uSWRzXHJcbiAgICB9O1xyXG59XHJcblxyXG4vL1xyXG5leHBvcnQgZnVuY3Rpb24gZGVsZXRlTm90aWZpY2F0aW9uKG5vdGlmaWNhdGlvbklkKSB7XHJcbiAgICByZXR1cm4gZnVuY3Rpb24gY2FsbERlbGV0ZU5vdGlmaWNhdGlvbihkaXNwYXRjaCkge1xyXG4gICAgICAgIC8vcmVhZCB0aGUgY29uZiBhZnRlciBleHRlbnNpb24uXHJcbiAgICAgICAgY29uc3QgY29uZmlnID0gZ2V0Q29uZmlnKCk7XHJcbiAgICAgICAgLy9DcmVhdGUgdGhlIFVSTFxyXG4gICAgICAgIGNvbnN0IFVSTCA9IGAke2NvbmZpZy5yb290VVJMfS8ke2NvbmZpZy5ub3RpZmljYXRpb25VUkx9YDtcclxuICAgICAgICAvL01heWJlIHNlZSBodHRwczovL2dpdGh1Yi5jb20vcmFja3QvcmVkdXgvaXNzdWVzLzkxMSNpc3N1ZWNvbW1lbnQtMTQ5MzYxMDczIGZvciBhIHNhbmVyIGltcGxlbWVudGF0aW9uIGluc3RlYWQgb2YgY2hhaW5pbmcgdHdvIGRpc3BhdGNoLlxyXG4gICAgICAgIGRpc3BhdGNoKGNsZWFyRXJyb3IoKSk7XHJcbiAgICAgICAgZGlzcGF0Y2gocmVhZE5vdGlmaWNhdGlvbihub3RpZmljYXRpb25JZCkpO1xyXG5cclxuICAgICAgICBjb25zdCBjcmVkZW50aWFsT3B0aW9ucyA9IGNvbmZpZy51c2VDcmVkZW50aWFscyA/IHsgY3JlZGVudGlhbHM6ICdpbmNsdWRlJ30gOiB7fTtcclxuICAgICAgICBjb25zdCBjb250ZW50VHlwZSA9IGNvbmZpZy5ub0NvbnRlbnRUeXBlID8ge30gOiBjb25maWcuY29udGVudFR5cGUgPyB7aGVhZGVyczoge2NvbnRlbnRUeXBlfX0gOiB7IGhlYWRlcnM6IHsnQ29udGVudC1UeXBlJzogJ2FwcGxpY2F0aW9uL2pzb24nIH19O1xyXG5cclxuICAgICAgICByZXR1cm4gZmV0Y2goYCR7VVJMfS8ke25vdGlmaWNhdGlvbklkfWAsIHttZXRob2Q6ICdkZWxldGUnLCAuLi5jcmVkZW50aWFsT3B0aW9ucywgLi4uY29udGVudFR5cGV9KVxyXG4gICAgICAgIC50aGVuKHJlc3BvbnNlID0+IHJlc3BvbnNlICYmIHJlc3BvbnNlLnN0YXR1cyAhPT0gMjA0ID8gcmVzcG9uc2UuanNvbigpIDogdW5kZWZpbmVkKVxyXG4gICAgICAgIC50aGVuKGpzb24gPT4gZGlzcGF0Y2goZGVsZXRlTm90aWZpY2F0aW9uU3VjY2Vzcyhqc29uKSkpXHJcbiAgICAgICAgLmNhdGNoKGVyciA9PiBkaXNwYXRjaChzZXRFcnJvcih7Y29udGVudDogZXJyLm1lc3NhZ2UsIHR5cGU6ICduZXR3b3JrJ30pKSk7XHJcbiAgICB9XHJcbn1cclxuXHJcbi8vXHJcbmV4cG9ydCBmdW5jdGlvbiBkZWxldGVHcm91cE5vdGlmaWNhdGlvbihub3RpZmljYXRpb25JZHMpIHtcclxuICAgIHJldHVybiBmdW5jdGlvbiBjYWxsRGVsZXRlTm90aWZpY2F0aW9uR3JvdXAoZGlzcGF0Y2gpIHtcclxuICAgICAgICAvL3JlYWQgdGhlIGNvbmYgYWZ0ZXIgZXh0ZW5zaW9uLlxyXG4gICAgICAgIGNvbnN0IGNvbmZpZyA9IGdldENvbmZpZygpO1xyXG4gICAgICAgIC8vQ3JlYXRlIHRoZSBVUkxcclxuICAgICAgICBjb25zdCBVUkwgPSBgJHtjb25maWcucm9vdFVSTH0vJHtjb25maWcubm90aWZpY2F0aW9uVVJMfWA7XHJcbiAgICAgICAgLy9NYXliZSBzZWUgaHR0cHM6Ly9naXRodWIuY29tL3JhY2t0L3JlZHV4L2lzc3Vlcy85MTEjaXNzdWVjb21tZW50LTE0OTM2MTA3MyBmb3IgYSBzYW5lciBpbXBsZW1lbnRhdGlvbiBpbnN0ZWFkIG9mIGNoYWluaW5nIHR3byBkaXNwYXRjaC5cclxuICAgICAgICBkaXNwYXRjaChjbGVhckVycm9yKCkpO1xyXG4gICAgICAgIGRpc3BhdGNoKHJlYWROb3RpZmljYXRpb25Hcm91cChub3RpZmljYXRpb25JZHMpKTtcclxuXHJcbiAgICAgICAgY29uc3QgY3JlZGVudGlhbE9wdGlvbnMgPSBjb25maWcudXNlQ3JlZGVudGlhbHMgPyB7IGNyZWRlbnRpYWxzOiAnaW5jbHVkZSd9IDoge307XHJcbiAgICAgICAgY29uc3QgY29udGVudFR5cGUgPSBjb25maWcubm9Db250ZW50VHlwZSA/IHt9IDogY29uZmlnLmNvbnRlbnRUeXBlID8ge2hlYWRlcnM6IHtjb250ZW50VHlwZX19IDogeyBoZWFkZXJzOiB7J0NvbnRlbnQtVHlwZSc6ICdhcHBsaWNhdGlvbi9qc29uJyB9fTtcclxuXHJcbiAgICAgICAgcmV0dXJuIGZldGNoKGAke1VSTH1gLCB7bWV0aG9kOiAnZGVsZXRlJywgYm9keTogSlNPTi5zdHJpbmdpZnkobm90aWZpY2F0aW9uSWRzKSwgLi4uY3JlZGVudGlhbE9wdGlvbnMsIC4uLmNvbnRlbnRUeXBlfSlcclxuICAgICAgICAudGhlbihyZXNwb25zZSA9PiByZXNwb25zZSAmJiByZXNwb25zZS5zdGF0dXMgIT09IDIwNCA/IHJlc3BvbnNlLmpzb24oKSA6IHVuZGVmaW5lZClcclxuICAgICAgICAgICAgLnRoZW4oanNvbiA9PiBkaXNwYXRjaChkZWxldGVOb3RpZmljYXRpb25Hcm91cFN1Y2Nlc3MoanNvbikpKVxyXG4gICAgICAgICAgICAuY2F0Y2goZXJyID0+IGRpc3BhdGNoKHNldEVycm9yKHtjb250ZW50OiBlcnIubWVzc2FnZSwgdHlwZTogJ25ldHdvcmsnfSkpKTtcclxuICAgIH1cclxufVxyXG4iXX0=